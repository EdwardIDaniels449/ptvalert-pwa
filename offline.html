<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0071e3">
    <title>PtvAlert - Á¶ªÁ∫øÊ®°Âºè</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background-color: #1c1c1e;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
        }
        
        .offline-container {
            max-width: 500px;
            padding: 30px;
            background-color: rgba(50, 50, 54, 0.95);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .icon-container {
            margin-bottom: 20px;
        }
        
        .icon {
            font-size: 64px;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        p {
            font-size: 16px;
            margin-bottom: 20px;
            color: #bbb;
            line-height: 1.5;
        }
        
        .button {
            display: inline-block;
            padding: 12px 24px;
            background-color: #0071e3;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 10px;
            cursor: pointer;
            border: none;
            font-size: 16px;
        }
        
        .secondary-button {
            background-color: rgba(255, 255, 255, 0.1);
            margin-right: 10px;
        }
        
        .cached-content {
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }
        
        .cached-content h2 {
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .cached-list {
            text-align: left;
            margin: 0 auto;
            max-width: 280px;
        }
        
        .cached-item {
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        
        .cached-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .language-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <button id="langSwitchBtn" class="language-switch">
        <span style="font-size:16px;">üåê</span>
        <span id="langSwitchText">EN</span>
    </button>
    
    <div class="offline-container">
        <div class="icon-container">
            <div class="icon">üì∂</div>
        </div>
        
        <h1 id="offline-title">ÊÇ®Â∑≤Á¶ªÁ∫ø</h1>
        <p id="offline-message">
            ÂΩìÂâçÊó†Ê≥ïËøûÊé•Âà∞‰∫íËÅîÁΩë„ÄÇPtvAlertÂú®Á¶ªÁ∫øÊ®°Âºè‰∏ã‰ªçÂèØ‰ΩøÁî®ÈÉ®ÂàÜÂäüËÉΩÔºå‰ΩÜÊó†Ê≥ïËé∑ÂèñÊúÄÊñ∞‰ø°ÊÅØÊàñÊ∑ªÂä†Êñ∞Êä•Âëä„ÄÇ
        </p>
        
        <div>
            <button class="button secondary-button" id="viewCached">Êü•ÁúãÂ∑≤ÁºìÂ≠òÂÜÖÂÆπ</button>
            <button class="button" id="tryReconnect">ÈáçËØïËøûÊé•</button>
        </div>
        
        <div class="cached-content" id="cachedContent" style="display: none;">
            <h2 id="cached-title">Â∑≤ÁºìÂ≠òÂÜÖÂÆπ</h2>
            <div class="cached-list" id="cachedList">
                <!-- Cached items will be inserted here dynamically -->
                <div class="cached-item">È¶ñÈ°µ</div>
            </div>
        </div>
    </div>
    
    <script>
        // Language settings
        let currentLang = 'zh';
        const i18n = {
            zh: {
                offlineTitle: 'ÊÇ®Â∑≤Á¶ªÁ∫ø',
                offlineMessage: 'ÂΩìÂâçÊó†Ê≥ïËøûÊé•Âà∞‰∫íËÅîÁΩë„ÄÇPtvAlertÂú®Á¶ªÁ∫øÊ®°Âºè‰∏ã‰ªçÂèØ‰ΩøÁî®ÈÉ®ÂàÜÂäüËÉΩÔºå‰ΩÜÊó†Ê≥ïËé∑ÂèñÊúÄÊñ∞‰ø°ÊÅØÊàñÊ∑ªÂä†Êñ∞Êä•Âëä„ÄÇ',
                viewCached: 'Êü•ÁúãÂ∑≤ÁºìÂ≠òÂÜÖÂÆπ',
                tryReconnect: 'ÈáçËØïËøûÊé•',
                cachedTitle: 'Â∑≤ÁºìÂ≠òÂÜÖÂÆπ',
                home: 'È¶ñÈ°µ'
            },
            en: {
                offlineTitle: 'You\'re Offline',
                offlineMessage: 'Currently unable to connect to the internet. PtvAlert can still work in offline mode with limited functionality, but you cannot get latest updates or add new reports.',
                viewCached: 'View Cached Content',
                tryReconnect: 'Try Again',
                cachedTitle: 'Cached Content',
                home: 'Home'
            }
        };
        
        // Update UI language
        function updateLanguage() {
            document.getElementById('offline-title').textContent = i18n[currentLang].offlineTitle;
            document.getElementById('offline-message').textContent = i18n[currentLang].offlineMessage;
            document.getElementById('viewCached').textContent = i18n[currentLang].viewCached;
            document.getElementById('tryReconnect').textContent = i18n[currentLang].tryReconnect;
            document.getElementById('cached-title').textContent = i18n[currentLang].cachedTitle;
            document.getElementById('langSwitchText').textContent = currentLang === 'zh' ? 'EN' : '‰∏≠';
            
            // Update cached items
            const cachedItems = document.querySelectorAll('.cached-item');
            if (cachedItems.length > 0) {
                cachedItems[0].textContent = i18n[currentLang].home;
            }
        }
        
        // Toggle language
        document.getElementById('langSwitchBtn').addEventListener('click', function() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            updateLanguage();
            
            // Save language preference
            localStorage.setItem('preferredLanguage', currentLang);
        });
        
        // Show cached content
        document.getElementById('viewCached').addEventListener('click', function() {
            const cachedContent = document.getElementById('cachedContent');
            if (cachedContent.style.display === 'none') {
                cachedContent.style.display = 'block';
                this.textContent = currentLang === 'zh' ? 'ÈöêËóèÂ∑≤ÁºìÂ≠òÂÜÖÂÆπ' : 'Hide Cached Content';
            } else {
                cachedContent.style.display = 'none';
                this.textContent = i18n[currentLang].viewCached;
            }
        });
        
        // Try reconnect
        document.getElementById('tryReconnect').addEventListener('click', function() {
            // Check network status
            if (navigator.onLine) {
                // If online, redirect to home page
                window.location.href = '/';
            } else {
                // If still offline, show message
                alert(currentLang === 'zh' ? '‰ªçÁÑ∂Êó†Ê≥ïËøûÊé•Âà∞ÁΩëÁªúÔºåËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÁΩëÁªúËÆæÁΩÆ„ÄÇ' : 'Still unable to connect. Please check your network settings.');
            }
        });
        
        // Check for cached pages and display them
        async function loadCachedPages() {
            if ('caches' in window) {
                try {
                    const cache = await caches.open('ptvalert-cache-v2');
                    const keys = await cache.keys();
                    const cachedList = document.getElementById('cachedList');
                    
                    // Clear existing items (except Home)
                    while (cachedList.children.length > 1) {
                        cachedList.removeChild(cachedList.lastChild);
                    }
                    
                    // Add cached pages to the list
                    const processedUrls = new Set();
                    processedUrls.add('/'); // Skip home page as it's already added
                    
                    for (const request of keys) {
                        const url = new URL(request.url);
                        const path = url.pathname;
                        
                        // Skip duplicates, API calls, and assets
                        if (processedUrls.has(path) || 
                            path.includes('/api/') || 
                            path.match(/\.(js|css|png|jpg|jpeg|gif|svg|ico)$/)) {
                            continue;
                        }
                        
                        // Create friendly name
                        let name = path;
                        if (path.endsWith('/')) {
                            name = path.slice(0, -1);
                        }
                        if (path.endsWith('.html')) {
                            name = path.replace('.html', '');
                        }
                        name = name.split('/').pop();
                        if (!name) name = 'home';
                        
                        // Make name more readable
                        name = name.charAt(0).toUpperCase() + name.slice(1);
                        name = name.replace(/-/g, ' ');
                        
                        processedUrls.add(path);
                        
                        // Skip if there's nothing readable
                        if (name === "" || name === "/" || name === "undefined") {
                            continue;
                        }
                        
                        // Create list item
                        const item = document.createElement('div');
                        item.className = 'cached-item';
                        item.textContent = name;
                        item.addEventListener('click', function() {
                            window.location.href = path;
                        });
                        
                        cachedList.appendChild(item);
                    }
                } catch (error) {
                    console.error('Error loading cached pages:', error);
                }
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load language preference
            const savedLanguage = localStorage.getItem('preferredLanguage');
            if (savedLanguage) {
                currentLang = savedLanguage;
            }
            
            updateLanguage();
            loadCachedPages();
            
            // Listen for online status changes
            window.addEventListener('online', function() {
                // When back online, redirect to home
                window.location.href = '/';
            });
        });
    </script>
</body>
</html> 