<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0071e3">
    <title>离线模式 - 无法连接到服务器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background-color: #1c1c1e;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
        }
        
        .offline-container {
            max-width: 500px;
            padding: 30px;
            background-color: rgba(50, 50, 54, 0.95);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .icon-container {
            margin-bottom: 20px;
        }
        
        .icon {
            font-size: 64px;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        p {
            font-size: 16px;
            margin-bottom: 20px;
            color: #bbb;
            line-height: 1.5;
        }
        
        .button {
            display: inline-block;
            padding: 12px 24px;
            background-color: #0071e3;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 10px;
            cursor: pointer;
            border: none;
            font-size: 16px;
        }
        
        .secondary-button {
            background-color: rgba(255, 255, 255, 0.1);
            margin-right: 10px;
        }
        
        .cached-content {
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }
        
        .cached-content h2 {
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .cached-list {
            text-align: left;
            margin: 0 auto;
            max-width: 280px;
        }
        
        .cached-item {
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        
        .cached-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .language-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .offline-icon {
            font-size: 80px;
            margin: 20px auto;
            color: #666;
        }
        
        .card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        button {
            background-color: #3498db;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            font-size: 16px;
            margin: 10px 0;
            cursor: pointer;
            border-radius: 4px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <button id="langSwitchBtn" class="language-switch">
        <span style="font-size:16px;">🌐</span>
        <span id="langSwitchText">EN</span>
    </button>
    
    <div class="offline-container">
        <div class="icon-container">
            <div class="icon">📡</div>
        </div>
        
        <h1 id="offline-title">您当前处于离线状态</h1>
        <div class="card">
            <p>无法连接到服务器。请检查您的网络连接后重试。</p>
            <p>部分功能在离线模式下可能不可用。</p>
            
            <button onclick="window.location.reload()">重新连接</button>
        </div>
        
        <div class="card">
            <h3>您可以尝试：</h3>
            <p>✓ 检查网络连接</p>
            <p>✓ 确认WiFi或移动数据已开启</p>
            <p>✓ 稍后再试</p>
        </div>
        
        <div class="cached-content" id="cachedContent" style="display: none;">
            <h2 id="cached-title">已缓存内容</h2>
            <div class="cached-list" id="cachedList">
                <!-- Cached items will be inserted here dynamically -->
                <div class="cached-item">首页</div>
            </div>
        </div>
    </div>
    
    <script>
        // Language settings
        let currentLang = 'zh';
        const i18n = {
            zh: {
                offlineTitle: '您已离线',
                offlineMessage: '当前无法连接到互联网。PtvAlert在离线模式下仍可使用部分功能，但无法获取最新信息或添加新报告。',
                viewCached: '查看已缓存内容',
                tryReconnect: '重试连接',
                cachedTitle: '已缓存内容',
                home: '首页'
            },
            en: {
                offlineTitle: 'You\'re Offline',
                offlineMessage: 'Currently unable to connect to the internet. PtvAlert can still work in offline mode with limited functionality, but you cannot get latest updates or add new reports.',
                viewCached: 'View Cached Content',
                tryReconnect: 'Try Again',
                cachedTitle: 'Cached Content',
                home: 'Home'
            }
        };
        
        // Update UI language
        function updateLanguage() {
            document.getElementById('offline-title').textContent = i18n[currentLang].offlineTitle;
            document.getElementById('offline-message').textContent = i18n[currentLang].offlineMessage;
            document.getElementById('viewCached').textContent = i18n[currentLang].viewCached;
            document.getElementById('tryReconnect').textContent = i18n[currentLang].tryReconnect;
            document.getElementById('cached-title').textContent = i18n[currentLang].cachedTitle;
            document.getElementById('langSwitchText').textContent = currentLang === 'zh' ? 'EN' : '中';
            
            // Update cached items
            const cachedItems = document.querySelectorAll('.cached-item');
            if (cachedItems.length > 0) {
                cachedItems[0].textContent = i18n[currentLang].home;
            }
        }
        
        // Toggle language
        document.getElementById('langSwitchBtn').addEventListener('click', function() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            updateLanguage();
            
            // Save language preference
            localStorage.setItem('preferredLanguage', currentLang);
        });
        
        // Show cached content
        document.getElementById('viewCached').addEventListener('click', function() {
            const cachedContent = document.getElementById('cachedContent');
            if (cachedContent.style.display === 'none') {
                cachedContent.style.display = 'block';
                this.textContent = currentLang === 'zh' ? '隐藏已缓存内容' : 'Hide Cached Content';
            } else {
                cachedContent.style.display = 'none';
                this.textContent = i18n[currentLang].viewCached;
            }
        });
        
        // Try reconnect
        document.getElementById('tryReconnect').addEventListener('click', function() {
            // Check network status
            if (navigator.onLine) {
                // If online, redirect to home page
                window.location.href = '/';
            } else {
                // If still offline, show message
                alert(currentLang === 'zh' ? '仍然无法连接到网络，请检查您的网络设置。' : 'Still unable to connect. Please check your network settings.');
            }
        });
        
        // Check for cached pages and display them
        async function loadCachedPages() {
            if ('caches' in window) {
                try {
                    const cache = await caches.open('ptvalert-cache-v2');
                    const keys = await cache.keys();
                    const cachedList = document.getElementById('cachedList');
                    
                    // Clear existing items (except Home)
                    while (cachedList.children.length > 1) {
                        cachedList.removeChild(cachedList.lastChild);
                    }
                    
                    // Add cached pages to the list
                    const processedUrls = new Set();
                    processedUrls.add('/'); // Skip home page as it's already added
                    
                    for (const request of keys) {
                        const url = new URL(request.url);
                        const path = url.pathname;
                        
                        // Skip duplicates, API calls, and assets
                        if (processedUrls.has(path) || 
                            path.includes('/api/') || 
                            path.match(/\.(js|css|png|jpg|jpeg|gif|svg|ico)$/)) {
                            continue;
                        }
                        
                        // Create friendly name
                        let name = path;
                        if (path.endsWith('/')) {
                            name = path.slice(0, -1);
                        }
                        if (path.endsWith('.html')) {
                            name = path.replace('.html', '');
                        }
                        name = name.split('/').pop();
                        if (!name) name = 'home';
                        
                        // Make name more readable
                        name = name.charAt(0).toUpperCase() + name.slice(1);
                        name = name.replace(/-/g, ' ');
                        
                        processedUrls.add(path);
                        
                        // Skip if there's nothing readable
                        if (name === "" || name === "/" || name === "undefined") {
                            continue;
                        }
                        
                        // Create list item
                        const item = document.createElement('div');
                        item.className = 'cached-item';
                        item.textContent = name;
                        item.addEventListener('click', function() {
                            window.location.href = path;
                        });
                        
                        cachedList.appendChild(item);
                    }
                } catch (error) {
                    console.error('Error loading cached pages:', error);
                }
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load language preference
            const savedLanguage = localStorage.getItem('preferredLanguage');
            if (savedLanguage) {
                currentLang = savedLanguage;
            }
            
            updateLanguage();
            loadCachedPages();
            
            // Listen for online status changes
            window.addEventListener('online', function() {
                // When back online, redirect to home
                window.location.href = '/';
            });
        });
    </script>
</body>
</html> 